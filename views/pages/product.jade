extends ../partials/skeleton

block prescript
	script(type='text/javascript', src='https://cdn.auth0.com/js/lock-7.5.min.js')
	script(type='text/javascript', src='/scripts/formFunctions.js')
	script(type='text/javascript', src='/scripts/getXrate.js')
	script(type='text/javascript', src='/scripts/chosen.jquery.js')
	link(rel='stylesheet', href='/stylesheets/checkout.css')
	link(rel='stylesheet', href='/stylesheets/chosen.css')
	script(type='text/javascript').

block content

	#product
		#leftside
			.Wallop.Wallop--fade
				.Wallop-pagination
					each image in items.images
						if image == image[1]
							button.Wallop-dot.Wallop-dot--current
						else
							button.Wallop-dot
				.Wallop-list
					each image in items.images
						if image == image[0]
							.Wallop-item.Wallop-item--current
								img(src="#{image}")
						else
							.Wallop-item
								img(src="#{image}")
				i.material-icons.Wallop-nav.Wallop-buttonNext navigate_next
				i.material-icons.Wallop-nav.Wallop-buttonPrevious navigate_before
		#rightside.com
			.browse.com__section
				.animate.slideInRight
					a(href="/categories/")
						i.material-icons.back-btn arrow_back
					form(class="view-product", action="#", role="form", method="POST")
						p #{items.sex} > #{items.category}
						h1 #{items.title}

						.tags
							each tag in items.tags
								.tag
									p #{tag}

						.clear
						p.rating Average rating: #{(items.rating).replace('%', '') * .10} / 10

						h2.price #{items.price}

						each selection in items.option
							select(name="option")
								each option in selection
									option(value="#{option[0]}") #{option[0]}
							.clear
						button(class="purchase com__nav-link", data-index="1", type="button") Order

			.ship.com__section
				.animate.slideInRight
					a(class="com__nav-link", data-index="0")
						i.material-icons.back-btn arrow_back
					.transactionprogress
						a(class="com__nav-link", data-index="0")
							p Order
						i(class="material-icons") navigate_next
						p Shipping
						.clear
					if user
						h1 Shipping time.
						h3 What address should we ship to?
						if addresses
							each address in addresses
								p address here!
						else
							p You don't seem to have any saved addresses. Let's create one!
							button.add-address-button New address
							#add-address
								h3 New address:
								include ../partials/address-form
							.clear
						h3 Go express?
						.express
							label(for="express") Express shipping ($15)
							input(type="checkbox" name="shipping" value="express")
							p Our standard shipping often takes around 30 days. This is partly how we manage to keep our prices down, slower shipping = lower costs. Alternatively, feel free to pay $15 for express shipping (5 - 10 days).
							h3 Almost done.
						button(class="purchase com__nav-link", data-index="2", type="button") Checkout
					else
						h1 Hold up!
						h3="Please "
							a(href="#", onClick="signin()")="log in "
							span to continue.

			.checkout.com__section
				.animate.slideInRight
					a(class="com__nav-link", data-index="1")
						i.material-icons.back-btn arrow_back
					.transactionprogress
						a(class="com__nav-link", data-index="0")
							p Order
						i(class="material-icons") navigate_next
						a(class="com__nav-link", data-index="2")
							p Shipping
						i(class="material-icons") navigate_next
						p Checkout
						.clear
					if user
						form(id="checkout", method="post", action="/checkout")
							#payment-form
							input(type="submit", value="Pay #{items.price}")

					else
						h1 How did you get here?!
						h3="Please "
							a(href="#", onClick="signin()")="log in "
							span to continue.
block scripts
	script(type='text/javascript').
		// ~~~~~~~~~~~~~~~~~ BRAINTREE ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		// We generated a client token for you so you can test out this code
		// immediately. In a production-ready integration, you will need to
		// generate a client token on your server (see section below).
		var clientToken = "eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiI4MTgwMmJhMmE0MThiYzY0ZGJkZmFiMDJiMTBlMGE4ZjEwODg3MTk2ODkzMGM2NWMzNDZhODMwZmNmMzVlOWU4fGNyZWF0ZWRfYXQ9MjAxNS0wOS0wMVQxNzoxMjozNy41MjQ1ODQyNzcrMDAwMFx1MDAyNm1lcmNoYW50X2lkPTM0OHBrOWNnZjNiZ3l3MmJcdTAwMjZwdWJsaWNfa2V5PTJuMjQ3ZHY4OWJxOXZtcHIiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvMzQ4cGs5Y2dmM2JneXcyYi9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbXSwiZW52aXJvbm1lbnQiOiJzYW5kYm94IiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzLzM0OHBrOWNnZjNiZ3l3MmIvY2xpZW50X2FwaSIsImFzc2V0c1VybCI6Imh0dHBzOi8vYXNzZXRzLmJyYWludHJlZWdhdGV3YXkuY29tIiwiYXV0aFVybCI6Imh0dHBzOi8vYXV0aC52ZW5tby5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIn0sInRocmVlRFNlY3VyZUVuYWJsZWQiOnRydWUsInRocmVlRFNlY3VyZSI6eyJsb29rdXBVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvMzQ4cGs5Y2dmM2JneXcyYi90aHJlZV9kX3NlY3VyZS9sb29rdXAifSwicGF5cGFsRW5hYmxlZCI6dHJ1ZSwicGF5cGFsIjp7ImRpc3BsYXlOYW1lIjoiQWNtZSBXaWRnZXRzLCBMdGQuIChTYW5kYm94KSIsImNsaWVudElkIjpudWxsLCJwcml2YWN5VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3BwIiwidXNlckFncmVlbWVudFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbS90b3MiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOnRydWUsImVudmlyb25tZW50Tm9OZXR3b3JrIjp0cnVlLCJlbnZpcm9ubWVudCI6Im9mZmxpbmUiLCJ1bnZldHRlZE1lcmNoYW50IjpmYWxzZSwiYnJhaW50cmVlQ2xpZW50SWQiOiJtYXN0ZXJjbGllbnQzIiwiYmlsbGluZ0FncmVlbWVudHNFbmFibGVkIjpmYWxzZSwibWVyY2hhbnRBY2NvdW50SWQiOiJhY21ld2lkZ2V0c2x0ZHNhbmRib3giLCJjdXJyZW5jeUlzb0NvZGUiOiJVU0QifSwiY29pbmJhc2VFbmFibGVkIjpmYWxzZSwibWVyY2hhbnRJZCI6IjM0OHBrOWNnZjNiZ3l3MmIiLCJ2ZW5tbyI6Im9mZiJ9";

		braintree.setup(clientToken, "dropin", {
		container: "payment-form"
		});
		// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

		// Update DOM | Looking pretty
		$('body').addClass('product man');
		$(".multiple-select").chosen({max_selected_options: 1});

		// ~~~~~~~~~~~~~~~~~ AUTH0 CODE ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
		var lock = new Auth0Lock('aDP9vhLVwnXkCUXCUXebeU6g6Y15tX6p', 'copicat.auth0.com');
		function signin() {
			lock.show({
				callbackURL: 'http://ec2-54-206-83-33.ap-southeast-2.compute.amazonaws.com:8080/login?redir=/#{root}?stage=1',
				responseType: 'code',
				authParams: {
					scope: 'openid profile'
				}
			});
		}
		// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

		$('.add-address-button').on('click', function(){
			$( "#add-address" ).slideDown( "medium", function() {
				$('.add-address-button').css({
					display: 'none'
				})
			});
		});

		$("#new-address").submit(function(event) {

			/* stop form from submitting normally */
			event.preventDefault();

			/* get some values from elements on the page: */
			var $form = $(this),
				url = $form.attr('action');

			/* Send the data using post */
			var submission = 	$.post( url, {
				contactName: 	$('#contactName').val(),
				contactId: 	$('#contactId').val(),
				contactNumber: 	$('#contactNumber').val(),
				address1: 		$('#address1').val(),
				address2: 		$('#address2').val(),
				postalCity: 	$('#postalCity').val(),
				postalState: 	$('#postalState').val(),
				postalZip: 		$('#postalZip').val(),
				postalCountry: 	$('#postalCountry').val()
			});

			/* Alerts the results */
			submission.done(function( data ) {
				alert('success');
			});
		});


	script(type='text/javascript', src='/scripts/checkout-animations.js')
	script(type='text/javascript', src='/scripts/product-wallop.js')

	// Init checkout
	script(type='text/javascript').
		activeFirst(#{stage});
